1:HL["/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
2:HL["/_next/static/css/a34a5d4c0484a85d.css","style",{"crossOrigin":""}]
0:["GbaOihNedOyA_d_SHMSJR",[[["",{"children":["articles",{"children":[["slug","posts/vagrant-over-libvirt-arch","c"],{"children":["__PAGE__?{\"slug\":[\"posts\",\"vagrant-over-libvirt-arch\"]}",{}]}]}]},"$undefined","$undefined",true],"$L3",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/a34a5d4c0484a85d.css","precedence":"next","crossOrigin":""}]],"$L4"]]]]
5:HL["/_next/static/css/1cb3813e458884a4.css","style",{"crossOrigin":""}]
6:I[5420,["326","static/chunks/326-dcee1ff54fa4f70c.js","185","static/chunks/app/layout-a31886c3387a77ea.js"],""]
7:I[6954,[],""]
8:I[7264,[],""]
b:I[8326,["954","static/chunks/d3ac728e-1e5d8b71e3d43fec.js","326","static/chunks/326-dcee1ff54fa4f70c.js","496","static/chunks/app/articles/%5B...slug%5D/page-d876e1e9a9f10cb2.js"],""]
c:T518,M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z3:[null,["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__className_e66fe9 Layout_body__oXsmr","children":[["$","header",null,{"className":"Layout_header__XC_Gv","children":["$","$L6",null,{}]}],["$","main",null,{"className":"Layout_main__luTTh","children":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"initialChildNode":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","articles","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","initialChildNode":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","articles","children",["slug","posts/vagrant-over-libvirt-arch","c"],"children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","initialChildNode":["$L9","$La",null],"childPropSegment":"__PAGE__?{\"slug\":[\"posts\",\"vagrant-over-libvirt-arch\"]}","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/1cb3813e458884a4.css","precedence":"next","crossOrigin":""}]]}],"childPropSegment":["slug","posts/vagrant-over-libvirt-arch","c"],"styles":null}],"childPropSegment":"articles","styles":null}]}],["$","footer",null,{"children":["$","div",null,{"className":"Footer_container__Z8cUU","children":[["$","$Lb",null,{"href":"https://il.linkedin.com/in/tal-glanzman","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 448 512","children":["$undefined",[["$","path","0",{"d":"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z","children":"$undefined"}]]],"className":"$undefined","style":{"color":"$undefined"},"height":"1em","width":"1em","xmlns":"http://www.w3.org/2000/svg"}]}],["$","$Lb",null,{"href":"https://github.com/tglanz","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 496 512","children":["$undefined",[["$","path","0",{"d":"$c","children":"$undefined"}]]],"className":"$undefined","style":{"color":"$undefined"},"height":"1em","width":"1em","xmlns":"http://www.w3.org/2000/svg"}]}]]}]}]]}]}],null]
4:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Article"}],["$","meta","3",{"name":"description","content":"Personal site"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}],["$","meta","5",{"name":"next-size-adjust"}]]
d:I[6222,["954","static/chunks/d3ac728e-1e5d8b71e3d43fec.js","326","static/chunks/326-dcee1ff54fa4f70c.js","496","static/chunks/app/articles/%5B...slug%5D/page-d876e1e9a9f10cb2.js"],"ArticleContent"]
e:Tefa,
# The tools

[Vagrant](https://www.vagrantup.com/) is an open source software to virtualize development environments.

[libvirt](https://libvit.org/) is an open source virtualization API. I think the [archwiki page](https://wiki.archlinux.org/title/Libvit) actually describes it better, as a collection of software that provides a way to manage virtualization functionality.

[kvm](https://www.linux-kvm.org/page/Main_Page/) a short for **K**ernel-based **V**irtual **M**achine, is a virtualization infrastructure provided by the kernel.

[QEMU](https://www.qemu.org/) is an open source machine emulator and virtualizer.

# The stack

Vagrant will use the libvirt APIs which will be drived by QEMU utilizing kvm.

```
+-----------+
|  Vagrant  |
+-----------+
|  libvirt  |
+-----------+
|  QEMU     |
+-----------+
|  KVM      |
+-----------
```

To install the stack we will need the following packages  
- [vagrant](https://archlinux.org/packages/?name=vagrant)
- [libvirt](https://archlinux.org/packages/?name=libvirt)
- [iptables-nft](https://archlinux.org/packages/?name=iptables-nft)
- [dnsmasq](https://archlinux.org/packages/?name=dnsmasq)
- [qemu-headless](https://archlinux.org/packages/?name=qemu-headless)

Run the command

    pacman -Suy vagrant libvirt iptables-nft dnsmasq qemu-headless

# Startup

In order to run the stack we need the following services running
- libvirtd.service 
- virtlogd.service

You can either start them by running

    systemctl start libvirtd virtlogd

Or you can enable them by running

    systemctl enable libvirtd virtlogd

You can check that everything is running by running

    virsh -c qemu:///system

> [virsh](https://linux.die.net/man/1/virsh) is a cli to interact with guest domains (virtual machines).

# Starting out first Vagrant Box

In Vagrant's domain, a Box is a package format, a bit like an ISO or a docker image. We will start a ```debian/bullseye64``` Boxed OS.

Inside your working directory, there should be a configuration file that Vagrant can read and function by - It is the ```Vagrantfile```. The Vagrantfile contains configuration about what Box to run, how many resources to allocate and more.

In a new environment, we can either create a file manually or use Vagrants ```init``` command to do this for us. 

    vagrant init --minimal

Now, lets edit the newly created Vagrantfile and set the parameter ```config.vm.box``` to "debian/bullseye64". Lets also add the following parameters  

We can always validate the Vagrantfile by running

    vagrant validate

At this point, during validation, you might get an error like ```No usable default provider could be found for your system```. Thats fine, see next.

Vagrant uses a notion of Providers. A Provider is Vagrant's abstraction over the underlying hypervisor that vagrant will operate. In our case, as illustrated above, we use libvirt as the hypervisor so we will need to install the relevant Provider. To install the Provider we will use Vagrant's Plugins mechanism and run

    vagrant plugin install vagrant-libvirt

Now we are finally ready to run the Box by running the command

    vagrant up --provider=libvirt

Some errors you might encounter

**Some error about polkit indicates permission issues**. Read about it for best scenario solution, as a quick and easy solution, add your user to the libvirt group

**Some error about your machine not supporting NFS.** Just install nfs-utils by running

    pacman -Syu nfs-utils

**Forevr waiting on IP acquisition.** I still havn't completely figured this out. It looks somethong about DNS and DHCP. What I did find out that some Boxes do not get this issue, try changing.

To ssh into the OS run

    vagrant ssh

To clean up run

    vagrant destroy

# Other tools

__virt-manager__ is a graphical tool to list and manage the guest domains.
f:T16a4,<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <nav class="toc">
      <ol class="toc-level toc-level-1">
        <li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#the-tools">The tools</a></li>
        <li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#the-stack">The stack</a></li>
        <li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#startup">Startup</a></li>
        <li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#starting-out-first-vagrant-box">Starting out first Vagrant Box</a></li>
        <li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#other-tools">Other tools</a></li>
      </ol>
    </nav>
    <h1 id="the-tools">The tools</h1>
    <p><a href="https://www.vagrantup.com/">Vagrant</a> is an open source software to virtualize development environments.</p>
    <p><a href="https://libvit.org/">libvirt</a> is an open source virtualization API. I think the <a href="https://wiki.archlinux.org/title/Libvit">archwiki page</a> actually describes it better, as a collection of software that provides a way to manage virtualization functionality.</p>
    <p><a href="https://www.linux-kvm.org/page/Main_Page/">kvm</a> a short for <strong>K</strong>ernel-based <strong>V</strong>irtual <strong>M</strong>achine, is a virtualization infrastructure provided by the kernel.</p>
    <p><a href="https://www.qemu.org/">QEMU</a> is an open source machine emulator and virtualizer.</p>
    <h1 id="the-stack">The stack</h1>
    <p>Vagrant will use the libvirt APIs which will be drived by QEMU utilizing kvm.</p>
    <pre><code>+-----------+
|  Vagrant  |
+-----------+
|  libvirt  |
+-----------+
|  QEMU     |
+-----------+
|  KVM      |
+-----------
</code></pre>
    <p>To install the stack we will need the following packages</p>
    <ul>
      <li><a href="https://archlinux.org/packages/?name=vagrant">vagrant</a></li>
      <li><a href="https://archlinux.org/packages/?name=libvirt">libvirt</a></li>
      <li><a href="https://archlinux.org/packages/?name=iptables-nft">iptables-nft</a></li>
      <li><a href="https://archlinux.org/packages/?name=dnsmasq">dnsmasq</a></li>
      <li><a href="https://archlinux.org/packages/?name=qemu-headless">qemu-headless</a></li>
    </ul>
    <p>Run the command</p>
    <pre><code>pacman -Suy vagrant libvirt iptables-nft dnsmasq qemu-headless
</code></pre>
    <h1 id="startup">Startup</h1>
    <p>In order to run the stack we need the following services running</p>
    <ul>
      <li>libvirtd.service</li>
      <li>virtlogd.service</li>
    </ul>
    <p>You can either start them by running</p>
    <pre><code>systemctl start libvirtd virtlogd
</code></pre>
    <p>Or you can enable them by running</p>
    <pre><code>systemctl enable libvirtd virtlogd
</code></pre>
    <p>You can check that everything is running by running</p>
    <pre><code>virsh -c qemu:///system
</code></pre>
    <blockquote>
      <p><a href="https://linux.die.net/man/1/virsh">virsh</a> is a cli to interact with guest domains (virtual machines).</p>
    </blockquote>
    <h1 id="starting-out-first-vagrant-box">Starting out first Vagrant Box</h1>
    <p>In Vagrant's domain, a Box is a package format, a bit like an ISO or a docker image. We will start a <code>debian/bullseye64</code> Boxed OS.</p>
    <p>Inside your working directory, there should be a configuration file that Vagrant can read and function by - It is the <code>Vagrantfile</code>. The Vagrantfile contains configuration about what Box to run, how many resources to allocate and more.</p>
    <p>In a new environment, we can either create a file manually or use Vagrants <code>init</code> command to do this for us.</p>
    <pre><code>vagrant init --minimal
</code></pre>
    <p>Now, lets edit the newly created Vagrantfile and set the parameter <code>config.vm.box</code> to "debian/bullseye64". Lets also add the following parameters</p>
    <p>We can always validate the Vagrantfile by running</p>
    <pre><code>vagrant validate
</code></pre>
    <p>At this point, during validation, you might get an error like <code>No usable default provider could be found for your system</code>. Thats fine, see next.</p>
    <p>Vagrant uses a notion of Providers. A Provider is Vagrant's abstraction over the underlying hypervisor that vagrant will operate. In our case, as illustrated above, we use libvirt as the hypervisor so we will need to install the relevant Provider. To install the Provider we will use Vagrant's Plugins mechanism and run</p>
    <pre><code>vagrant plugin install vagrant-libvirt
</code></pre>
    <p>Now we are finally ready to run the Box by running the command</p>
    <pre><code>vagrant up --provider=libvirt
</code></pre>
    <p>Some errors you might encounter</p>
    <p><strong>Some error about polkit indicates permission issues</strong>. Read about it for best scenario solution, as a quick and easy solution, add your user to the libvirt group</p>
    <p><strong>Some error about your machine not supporting NFS.</strong> Just install nfs-utils by running</p>
    <pre><code>pacman -Syu nfs-utils
</code></pre>
    <p><strong>Forevr waiting on IP acquisition.</strong> I still havn't completely figured this out. It looks somethong about DNS and DHCP. What I did find out that some Boxes do not get this issue, try changing.</p>
    <p>To ssh into the OS run</p>
    <pre><code>vagrant ssh
</code></pre>
    <p>To clean up run</p>
    <pre><code>vagrant destroy
</code></pre>
    <h1 id="other-tools">Other tools</h1>
    <p><strong>virt-manager</strong> is a graphical tool to list and manage the guest domains.</p>
  </body>
</html>
a:["$","div",null,{"className":"article-page_container__5yaZl","children":[["$","h1",null,{"children":"Vagrant over libvirt on Archlinux"}],["$","div",null,{"className":"Taxonomy_container__C2Vdb","children":["$","div",null,{"className":"Taxonomy_values__yvK16","children":[["$","$Lb","0",{"href":"/tags/Linux","children":["$","div",null,{"className":"Chip_container__q1AW2","children":"Linux"}]}],["$","$Lb","1",{"href":"/tags/Archlinux","children":["$","div",null,{"className":"Chip_container__q1AW2","children":"Archlinux"}]}],["$","$Lb","2",{"href":"/tags/Vagrant","children":["$","div",null,{"className":"Chip_container__q1AW2","children":"Vagrant"}]}]]}]}],["$","$Ld",null,{"content":{"raw":"$e","html":"$f"}}]]}]
9:null
