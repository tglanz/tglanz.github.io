<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/fc3ec0f12aa27086.css" as="style"/><link rel="stylesheet" href="/_next/static/css/fc3ec0f12aa27086.css" data-n-g=""/><link rel="preload" href="/_next/static/css/ac5752a50daec8d4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ac5752a50daec8d4.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-20cc5a3cc3d233fe.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-97927b8cd08b2c1f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0fb546fbb661cca9.js" defer=""></script><script src="/_next/static/chunks/175675d1-7de8b3bfdcedb0f1.js" defer=""></script><script src="/_next/static/chunks/113-d38bb2befbc77dc7.js" defer=""></script><script src="/_next/static/chunks/pages/_articles/%5B...articleId%5D-14c11b9e88d91c56.js" defer=""></script><script src="/_next/static/2MCVNdTWbOVg7ou666Ke5/_buildManifest.js" defer=""></script><script src="/_next/static/2MCVNdTWbOVg7ou666Ke5/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="Layout_container__K9hpm"><nav class="p-6 border border-r-2"><div class="flex flex-col items-center"><img src="/logo.png" width="100" height="100"/><span class="text-3xl font-semibold">Tal Glanzman</span><span class="text-lg">Software Engineer</span></div><div class="mt-6"><ul><li><a href="/">Home</a></li><li><a href="/_index/">Index</a></li><details><summary>Computer Science</summary><ul class="ml-4"><li><a href="/_articles/computer-science/linear-programming/">Linear Programming</a></li></ul></details><li><a href="/_articles/about/">About</a></li></ul></div><div class="mt-6"><div><form action="/_search" autoComplete="off" class="flex flex-col justify-center items-center"><input class="text-input" type="text" name="query" placeholder="Search"/><input class="button" type="submit" hidden="" value="Search"/></form></div></div></nav><header><div class=" p-2 flex flex-col items-center"><span class="text-4xl font-semibold">Elasticsearch Notes</span><span class="text-lg"></span></div></header><main><div class="text-sm m-4"><div><span>Categories<!-- -->: </span><span><span class="inline-block"><a href="/_categories/Elasticsearch/">Elasticsearch</a></span><span class="inline-block">, <a href="/_categories/Notes/">Notes</a></span></span></div><div><span>Tags<!-- -->: </span><span><span class="inline-block"><a href="/_tags/Elasticsearch/">Elasticsearch</a></span></span></div></div><div class="ArticleContent_md__52PoF"><!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <nav class="toc">
      <ol class="toc-level toc-level-1">
        <li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#what-is-elasticsearch">What is Elasticsearch</a></li>
        <li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#documents--indices">Documents &#x26; Indices</a></li>
        <li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#search--aggregations">Search &#x26; Aggregations</a></li>
      </ol>
    </nav>
    <p>Concepts and examples to get reminded of once in a whilei</p>
    <h2 id="what-is-elasticsearch">What is Elasticsearch</h2>
    <p><em>Elasticsearch</em> is a distributed search and analytics engine, providing a <em>near real-time</em> search for a large array of data types, structured or un-structured.</p>
    <p>Some of the usecases</p>
    <ul>
      <li>Backend for search boxes</li>
      <li>Metrics and Log analysis</li>
    </ul>
    <p>Elasticsearch uses <em>Apache Lucene</em> under the hood as it's underlying search engine.</p>
    <h2 id="documents--indices">Documents &#x26; Indices</h2>
    <p>Technically, and I quote - "Elasticsearch is a distributed documented store". It serializes any kind of structure into JSON documents. In an Elasticsearch cluster, the documents are distributed accross multiple nodes and are accessible from any (really?) of the nodes.</p>
    <p><strong>TODO</strong> Are the documents distributed accross all nodes, or a part of the cluster? It actually seems unreasonable to me that it is a full replication.</p>
    <p>Elasticsearch maintains an <em>Inverted Index</em> to provide fast search capabilities on all of a document's fields (They say that a document is fully searchable within 1 sec). Practically, the index is the data structure the collects multiple documents and provides fast access to them according to search criteria.</p>
    <p>We can think of the model as such</p>
    <pre><code class="hljs language-properties"><span class="hljs-attr">Field</span>
    <span class="hljs-attr">key</span>: <span class="hljs-string">String</span>
    <span class="hljs-attr">value</span>: <span class="hljs-string">Any</span>

<span class="hljs-attr">Document</span>
    <span class="hljs-attr">fields</span>: <span class="hljs-string">Field[]</span>

<span class="hljs-attr">Index</span>
    <span class="hljs-attr">documents</span>: <span class="hljs-string">Document[]</span>
</code></pre>
    <p>By default, Elasticsearch index all fields in all documents, and it has different mehcanisms to index different data types.</p>
    <h2 id="search--aggregations">Search &#x26; Aggregations</h2>
    <p>Elasticsearch provides a REST API that supports</p>
    <ul>
      <li>Structured queries - Queries that are structurely similiar to SQL queries</li>
      <li>Full text queries - Queries that return all documents that match the query, sorted by relevance</li>
      <li>Complex queries - A combination of the above</li>
    </ul>
    <p>Elasticsearch can maintain aggregations of the data enabling us to analyze summaries providing insights regarding metrics, patterns and trends. For example, we can query for</p>
    <ul>
      <li>Total numbers that match X</li>
      <li>The average that match Y</li>
    </ul>
    <p>Furthermore, aggregations can operate alongside the search requests, meaning that we can gain aggregative information for all search results.</p>
    <h3 id="cat-api">cat API</h3>
    <p>The <code>_cat</code> endpoint provides "Compact and Aligned Text" meaning, a general, <strong>consumed by humans</strong> information.</p>
    <p>Get the list of cat APIs</p>
    <pre><code class="hljs language-bash">/_cat
</code></pre>
    <p>Get information about indices using <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-indices.html">cat indices API</a></p>
    <pre><code class="hljs language-awk"><span class="hljs-regexp">/_cat/i</span>ndices
<span class="hljs-regexp">/_cat/i</span>ndices/_all
<span class="hljs-regexp">/_cat/i</span>ndices?format=json
<span class="hljs-regexp">/_cat/i</span>ndices/my-index
<span class="hljs-regexp">/_cat/i</span>ndices/my-index?format=json
</code></pre>
    <h3 id="search-api">search API</h3>
    <p>The <code>&#x3C;target>/_search</code> endpoint provides searching functionality.</p>
    <p>The <code>&#x3C;target></code> parameter is optional and is a comma seperated list indicating data streams, indices and aliases to search. It supports wildcards (*).</p>
    <p>There are many query parameters that affects how the search is being performed and how the results are being returned. We won't list them all here but here is a small list that give a vibe on the kind of possible parameters</p>
    <ul>
      <li>q(string) - The query. Note that it can alternetively be provided through the body</li>
      <li>explain(boolean) - If true, returns a defailed information about the score computation</li>
      <li>timeout(time units) - Sets the timeout for the request</li>
      <li>from(integer) - Starting document offset</li>
      <li>size(integer) - Number of hits to return</li>
    </ul>
    <p>The body also contains important information the important one is the "query" field.</p>
    <h3 id="shards">shards</h3>
    <p>Show shards</p>
    <pre><code class="hljs language-awk"><span class="hljs-regexp">/_cat/</span>shards
<span class="hljs-regexp">/_cat/</span>shards?h=index,shard
</code></pre>
    <h3 id="usage">Usage</h3>
    <h4 id="basics-insert-and-retrieve-documents">Basics, insert and retrieve documents</h4>
    <p>Assume the scenario with indices <code>tglanzma-small-1,2,3</code> and a document model</p>
    <pre><code class="hljs language-properties"><span class="hljs-attr">{</span>
    <span class="hljs-attr">_id</span>: <span class="hljs-string">string</span>
    <span class="hljs-attr">x</span>: <span class="hljs-string">string</span>
    <span class="hljs-attr">y</span>: <span class="hljs-string">string</span>
    <span class="hljs-attr">z</span>: <span class="hljs-string">number</span>
    <span class="hljs-attr">tags</span>: <span class="hljs-string">string[]</span>
<span class="hljs-attr">}</span>
</code></pre>
    <p>To add documents to and index we use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html">Index API</a>. For example</p>
    <pre><code class="hljs language-properties"><span class="hljs-attr">PUT</span> <span class="hljs-string">tglanzma-small-1/_doc/1</span>
<span class="hljs-attr">{</span>
  <span class="hljs-attr">"x"</span>: <span class="hljs-string">"x of 1",</span>
  <span class="hljs-attr">"y"</span>: <span class="hljs-string">"y of 1",</span>
  <span class="hljs-attr">"z"</span>: <span class="hljs-string">1,</span>
  <span class="hljs-attr">"tags"</span>: <span class="hljs-string">[</span>
    <span class="hljs-attr">"first</span> <span class="hljs-string">tag of 1",</span>
    <span class="hljs-attr">"second</span> <span class="hljs-string">tag of 1"</span>
  <span class="hljs-attr">]</span>
<span class="hljs-attr">}</span>
</code></pre>
    <p>To get a specific document by it's id we use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-get.html">Document's Get API</a>. For example</p>
    <pre><code class="hljs language-apache"><span class="hljs-attribute">GET</span> tglanzma-small-<span class="hljs-number">1</span>/_doc/<span class="hljs-number">1</span>
</code></pre>
    <p>To get multiple documents by their ids, use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-multi-get.html">Multi get API</a>. For example</p>
    <pre><code class="hljs language-properties"><span class="hljs-attr">GET</span> <span class="hljs-string">_mget</span>
<span class="hljs-attr">{</span>
  <span class="hljs-attr">"docs"</span>: <span class="hljs-string">[{</span>
    <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"tglanzma-small-1",</span>
    <span class="hljs-attr">"_id"</span>: <span class="hljs-string">1</span>
  <span class="hljs-attr">},</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"tglanzma-small-1",</span>
    <span class="hljs-attr">"_id"</span>: <span class="hljs-string">2</span>
  <span class="hljs-attr">}]</span>
<span class="hljs-attr">}</span>
</code></pre>
    <h3 id="searching-an-index">Searching an index</h3>
    <p>To search for documents we use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-search.html">Search API</a>.</p>
    <p>To search for all documents within a specific index</p>
    <pre><code class="hljs language-excel">GET tglanzma-<span class="hljs-built_in">small</span>-<span class="hljs-number">1</span>/_<span class="hljs-built_in">search</span>
</code></pre>
    <p>To specify exactly what fields we want returned from each document we will use the <code>_source</code> parameter, as so</p>
    <pre><code class="hljs language-properties"><span class="hljs-attr">GET</span> <span class="hljs-string">tglanzma-small-1/_search</span>
<span class="hljs-attr">{</span>
  <span class="hljs-attr">"_source"</span>: <span class="hljs-string">[</span>
    <span class="hljs-attr">"x",</span>
    <span class="hljs-attr">"y"</span>
  <span class="hljs-attr">]</span>
<span class="hljs-attr">}</span>
</code></pre>
    <p>To specify the search query we use the <code>query</code> parameter. This is a query object and we specify it using the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">Query DSL</a>.</p>
    <p>The Query DSL is an AST defined as</p>
    <pre><code class="hljs language-properties"><span class="hljs-attr">Query</span> :<span class="hljs-string">= Leaf | Compound</span>
<span class="hljs-attr">Compound</span> :<span class="hljs-string">= [Compound | Leaf]</span>
</code></pre>
    <p>Search documents where <code>x === x of 1</code> we use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html">Match phrase query</a></p>
    <pre><code class="hljs language-properties"><span class="hljs-attr">GET</span> <span class="hljs-string">tglanzma-small-1/_search</span>
<span class="hljs-attr">{</span>
  <span class="hljs-attr">"query"</span>: <span class="hljs-string">{</span>
    <span class="hljs-attr">"bool"</span>: <span class="hljs-string">{</span>
      <span class="hljs-attr">"must"</span>: <span class="hljs-string">[</span>
        <span class="hljs-attr">{</span>
          <span class="hljs-attr">"match_phrase"</span>: <span class="hljs-string">{</span>
            <span class="hljs-attr">"x"</span>: <span class="hljs-string">"x of 1"</span>
          <span class="hljs-attr">}</span>
        <span class="hljs-attr">}</span>
      <span class="hljs-attr">]</span>
    <span class="hljs-attr">}</span>
  <span class="hljs-attr">}</span>
<span class="hljs-attr">}</span>
</code></pre>
    <p>For a fuzzy search, we use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html">Match query</a>.</p>
    <pre><code class="hljs language-properties"><span class="hljs-attr">GET</span> <span class="hljs-string">tglanzma-small-1/_search</span>
<span class="hljs-attr">{</span>
  <span class="hljs-attr">"query"</span>: <span class="hljs-string">{</span>
    <span class="hljs-attr">"bool"</span>: <span class="hljs-string">{</span>
      <span class="hljs-attr">"must"</span>: <span class="hljs-string">[</span>
        <span class="hljs-attr">{</span>
          <span class="hljs-attr">"match"</span>: <span class="hljs-string">{</span>
            <span class="hljs-attr">"x"</span>: <span class="hljs-string">"x of 1"</span>
          <span class="hljs-attr">}</span>
        <span class="hljs-attr">}</span>
      <span class="hljs-attr">]</span>
    <span class="hljs-attr">}</span>
  <span class="hljs-attr">}</span>
<span class="hljs-attr">}</span>
</code></pre>
    <p>The returned documents might not have an exact match because we fuzzy searched. Each document is assigned with a score determining how close it is to a full match. We can control the minimum we want using the <code>min_score</code> parameter</p>
    <pre><code class="hljs language-properties"><span class="hljs-attr">GET</span> <span class="hljs-string">tglanzma-small-1/_search</span>
<span class="hljs-attr">{</span>
  <span class="hljs-attr">"min_score"</span>: <span class="hljs-string">0.6,</span>
  <span class="hljs-attr">"query"</span>: <span class="hljs-string">{</span>
    <span class="hljs-attr">"bool"</span>: <span class="hljs-string">{</span>
      <span class="hljs-attr">"must"</span>: <span class="hljs-string">[</span>
        <span class="hljs-attr">{</span>
          <span class="hljs-attr">"match"</span>: <span class="hljs-string">{</span>
            <span class="hljs-attr">"x"</span>: <span class="hljs-string">"x of 1"</span>
          <span class="hljs-attr">}</span>
        <span class="hljs-attr">}</span>
      <span class="hljs-attr">]</span>
    <span class="hljs-attr">}</span>
  <span class="hljs-attr">}</span>
<span class="hljs-attr">}</span>
</code></pre>
    <p>The <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html">Boolean query</a> matches boolean combinations over documents.</p>
    <p>The <code>must</code> acts as an AND operator and the <code>should</code> acts as an OR operator. Intuitively, the <code>must_not</code> acts as negation.</p>
    <p>To search for query that have either <code>x = x of 1</code> and <code>y = y of 1</code> we use the <code>must</code> query</p>
    <pre><code class="hljs language-properties"><span class="hljs-attr">GET</span> <span class="hljs-string">tglanzma-small-1/_search</span>
<span class="hljs-attr">{</span>
  <span class="hljs-attr">"min_score"</span>: <span class="hljs-string">0.6,</span>
  <span class="hljs-attr">"query"</span>: <span class="hljs-string">{</span>
    <span class="hljs-attr">"bool"</span>: <span class="hljs-string">{</span>
      <span class="hljs-attr">"must"</span>: <span class="hljs-string">[</span>
        <span class="hljs-attr">{</span>
          <span class="hljs-attr">"match_phrase"</span>: <span class="hljs-string">{</span>
            <span class="hljs-attr">"x"</span>: <span class="hljs-string">"x of 1"</span>
          <span class="hljs-attr">}</span>
        <span class="hljs-attr">},</span>
        <span class="hljs-attr">{</span>
          <span class="hljs-attr">"match_phrase"</span>: <span class="hljs-string">{</span>
            <span class="hljs-attr">"y"</span>: <span class="hljs-string">"y of 1"</span>
          <span class="hljs-attr">}</span>
        <span class="hljs-attr">}</span>
      <span class="hljs-attr">]</span>
    <span class="hljs-attr">}</span>
  <span class="hljs-attr">}</span>
<span class="hljs-attr">}</span>
</code></pre>
    <p>To search for query that have either <code>x = x of 1</code> or <code>y = y of 2</code> we use the <code>should</code> query</p>
    <pre><code class="hljs language-properties"><span class="hljs-attr">GET</span> <span class="hljs-string">tglanzma-small-1/_search</span>
<span class="hljs-attr">{</span>
  <span class="hljs-attr">"min_score"</span>: <span class="hljs-string">0.6,</span>
  <span class="hljs-attr">"query"</span>: <span class="hljs-string">{</span>
    <span class="hljs-attr">"bool"</span>: <span class="hljs-string">{</span>
      <span class="hljs-attr">"should"</span>: <span class="hljs-string">[</span>
        <span class="hljs-attr">{</span>
          <span class="hljs-attr">"match_phrase"</span>: <span class="hljs-string">{</span>
            <span class="hljs-attr">"x"</span>: <span class="hljs-string">"x of 1"</span>
          <span class="hljs-attr">}</span>
        <span class="hljs-attr">},</span>
        <span class="hljs-attr">{</span>
          <span class="hljs-attr">"match_phrase"</span>: <span class="hljs-string">{</span>
            <span class="hljs-attr">"y"</span>: <span class="hljs-string">"y of 2"</span>
          <span class="hljs-attr">}</span>
        <span class="hljs-attr">}</span>
      <span class="hljs-attr">]</span>
    <span class="hljs-attr">}</span>
  <span class="hljs-attr">}</span>
<span class="hljs-attr">}</span>
</code></pre>
    <p>As mentioned, compound queries are recursively defined so we can compose combinations. For example, to match documents where (<code>x = x of 1</code> AND <code>y = y of 1</code>) OR (<code>x = x of 2</code> AND <code>y = y of 2</code>)</p>
    <pre><code class="hljs language-properties"><span class="hljs-attr">GET</span> <span class="hljs-string">tglanzma-small-1/_search</span>
<span class="hljs-attr">{</span>
  <span class="hljs-attr">"min_score"</span>: <span class="hljs-string">0.6,</span>
  <span class="hljs-attr">"query"</span>: <span class="hljs-string">{</span>
    <span class="hljs-attr">"bool"</span>: <span class="hljs-string">{</span>
      <span class="hljs-attr">"should"</span>: <span class="hljs-string">[</span>
        <span class="hljs-attr">{</span>
          <span class="hljs-attr">"bool"</span>: <span class="hljs-string">{</span>
            <span class="hljs-attr">"must"</span>: <span class="hljs-string">[</span>
              <span class="hljs-attr">{</span>
                <span class="hljs-attr">"match_phrase"</span>: <span class="hljs-string">{</span>
                  <span class="hljs-attr">"x"</span>: <span class="hljs-string">"x of 1"</span>
                <span class="hljs-attr">}</span>
              <span class="hljs-attr">},</span>
              <span class="hljs-attr">{</span>
                <span class="hljs-attr">"match_phrase"</span>: <span class="hljs-string">{</span>
                  <span class="hljs-attr">"y"</span>: <span class="hljs-string">"y of 1"</span>
                <span class="hljs-attr">}</span>
              <span class="hljs-attr">}</span>
            <span class="hljs-attr">]</span>
          <span class="hljs-attr">}</span>
        <span class="hljs-attr">},</span>
        <span class="hljs-attr">{</span>
          <span class="hljs-attr">"bool"</span>: <span class="hljs-string">{</span>
            <span class="hljs-attr">"must"</span>: <span class="hljs-string">[</span>
              <span class="hljs-attr">{</span>
                <span class="hljs-attr">"match_phrase"</span>: <span class="hljs-string">{</span>
                  <span class="hljs-attr">"x"</span>: <span class="hljs-string">"x of 2"</span>
                <span class="hljs-attr">}</span>
              <span class="hljs-attr">},</span>
              <span class="hljs-attr">{</span>
                <span class="hljs-attr">"match_phrase"</span>: <span class="hljs-string">{</span>
                  <span class="hljs-attr">"y"</span>: <span class="hljs-string">"y of 2"</span>
                <span class="hljs-attr">}</span>
              <span class="hljs-attr">}</span>
            <span class="hljs-attr">]</span>
          <span class="hljs-attr">}</span>
        <span class="hljs-attr">}</span>
      <span class="hljs-attr">]</span>
    <span class="hljs-attr">}</span>
  <span class="hljs-attr">}</span>
<span class="hljs-attr">}</span>
</code></pre>
  </body>
</html>
</div></main><footer><div class=" border-t-2 p-4 flex flex-row justify-center items-center space-x-4"><a href="https://github.com/tglanz"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://il.linkedin.com/in/tal-glanzman"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"id":"elastic/overview","filePath":"/home/runner/work/tglanz.github.io/tglanz.github.io/content/elastic/overview.md","metadata":{"title":"Elasticsearch Notes","description":null,"priority":0,"tags":["Elasticsearch"],"categories":["Elasticsearch","Notes"],"toc":true},"content":{"raw":"\nConcepts and examples to get reminded of once in a whilei\n\n## What is Elasticsearch \n\n_Elasticsearch_ is a distributed search and analytics engine, providing a _near real-time_ search for a large array of data types, structured or un-structured.\n\nSome of the usecases\n- Backend for search boxes\n- Metrics and Log analysis\n\nElasticsearch uses _Apache Lucene_ under the hood as it's underlying search engine.\n\n## Documents \u0026 Indices\n\nTechnically, and I quote - \"Elasticsearch is a distributed documented store\". It serializes any kind of structure into JSON documents. In an Elasticsearch cluster, the documents are distributed accross multiple nodes and are accessible from any (really?) of the nodes.\n\n__TODO__ Are the documents distributed accross all nodes, or a part of the cluster? It actually seems unreasonable to me that it is a full replication.\n\nElasticsearch maintains an _Inverted Index_ to provide fast search capabilities on all of a document's fields (They say that a document is fully searchable within 1 sec). Practically, the index is the data structure the collects multiple documents and provides fast access to them according to search criteria.\n\nWe can think of the model as such\n```\nField\n    key: String\n    value: Any\n\nDocument\n    fields: Field[]\n\nIndex\n    documents: Document[]\n```\n\nBy default, Elasticsearch index all fields in all documents, and it has different mehcanisms to index different data types.\n\n## Search \u0026 Aggregations\n\nElasticsearch provides a REST API that supports\n- Structured queries -  Queries that are structurely similiar to SQL queries\n- Full text queries - Queries that return all documents that match the query, sorted by relevance\n- Complex queries - A combination of the above\n\nElasticsearch can maintain aggregations of the data enabling us to analyze summaries providing insights regarding metrics, patterns and trends. For example, we can query for\n- Total numbers that match X\n- The average that match Y\n\nFurthermore, aggregations can operate alongside the search requests, meaning that we can gain aggregative information for all search results.\n\n### cat API\n\nThe ```_cat``` endpoint provides \"Compact and Aligned Text\" meaning, a general, __consumed by humans__ information.\n\nGet the list of cat APIs\n\n    /_cat\n\nGet information about indices using [cat indices API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-indices.html)\n\n    /_cat/indices\n    /_cat/indices/_all\n    /_cat/indices?format=json\n    /_cat/indices/my-index\n    /_cat/indices/my-index?format=json\n\n### search API\n\nThe ```\u003ctarget\u003e/_search``` endpoint provides searching functionality.\n\nThe ```\u003ctarget\u003e``` parameter is optional and is a comma seperated list indicating data streams, indices and aliases to search. It supports wildcards (*).\n\nThere are many query parameters that affects how the search is being performed and how the results are being returned. We won't list them all here but here is a small list that give a vibe on the kind of possible parameters\n\n- q(string) - The query. Note that it can alternetively be provided through the body\n- explain(boolean) - If true, returns a defailed information about the score computation  \n- timeout(time units) - Sets the timeout for the request  \n- from(integer) - Starting document offset  \n- size(integer) - Number of hits to return  \n\nThe body also contains important information the important one is the \"query\" field.\n\n### shards\n\nShow shards\n\n    /_cat/shards\n    /_cat/shards?h=index,shard\n\n### Usage\n\n#### Basics, insert and retrieve documents\n\nAssume the scenario with indices ```tglanzma-small-1,2,3``` and a document model\n\n```\n{\n    _id: string\n    x: string\n    y: string\n    z: number\n    tags: string[]\n}\n```\n\nTo add documents to and index we use the [Index API](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html). For example\n\n```\nPUT tglanzma-small-1/_doc/1\n{\n  \"x\": \"x of 1\",\n  \"y\": \"y of 1\",\n  \"z\": 1,\n  \"tags\": [\n    \"first tag of 1\",\n    \"second tag of 1\"\n  ]\n}\n```\n\nTo get a specific document by it's id we use the [Document's Get API](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-get.html). For example\n\n```\nGET tglanzma-small-1/_doc/1\n```\n\nTo get multiple documents by their ids, use the [Multi get API](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-multi-get.html). For example\n\n```\nGET _mget\n{\n  \"docs\": [{\n    \"_index\": \"tglanzma-small-1\",\n    \"_id\": 1\n  }, {\n    \"_index\": \"tglanzma-small-1\",\n    \"_id\": 2\n  }]\n}\n```\n\n### Searching an index\n\nTo search for documents we use the [Search API](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-search.html).\n\nTo search for all documents within a specific index\n\n```\nGET tglanzma-small-1/_search\n```\n\nTo specify exactly what fields we want returned from each document we will use the ```_source``` parameter, as so\n\n```\nGET tglanzma-small-1/_search\n{\n  \"_source\": [\n    \"x\",\n    \"y\"\n  ]\n}\n```\n\nTo specify the search query we use the ```query``` parameter. This is a query object and we specify it using the [Query DSL](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html).\n\nThe Query DSL is an AST defined as\n\n```\nQuery := Leaf | Compound\nCompound := [Compound | Leaf]\n```\n\n\nSearch documents where ```x === x of 1``` we use the [Match phrase query](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html)\n\n```\nGET tglanzma-small-1/_search\n{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"match_phrase\": {\n            \"x\": \"x of 1\"\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\nFor a fuzzy search, we use the [Match query](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html).\n\n```\nGET tglanzma-small-1/_search\n{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"match\": {\n            \"x\": \"x of 1\"\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\nThe returned documents might not have an exact match because we fuzzy searched. Each document is assigned with a score determining how close it is to a full match. We can control the minimum we want using the ```min_score``` parameter\n\n```\nGET tglanzma-small-1/_search\n{\n  \"min_score\": 0.6,\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"match\": {\n            \"x\": \"x of 1\"\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\nThe [Boolean query](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html) matches boolean combinations over documents.\n\nThe ```must``` acts as an AND operator and the ```should``` acts as an OR operator. Intuitively, the ```must_not``` acts as negation.\n\nTo search for query that have either ```x = x of 1``` and ```y = y of 1``` we use the ```must``` query\n\n```\nGET tglanzma-small-1/_search\n{\n  \"min_score\": 0.6,\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"match_phrase\": {\n            \"x\": \"x of 1\"\n          }\n        },\n        {\n          \"match_phrase\": {\n            \"y\": \"y of 1\"\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\nTo search for query that have either ```x = x of 1``` or ```y = y of 2``` we use the ```should``` query\n\n```\nGET tglanzma-small-1/_search\n{\n  \"min_score\": 0.6,\n  \"query\": {\n    \"bool\": {\n      \"should\": [\n        {\n          \"match_phrase\": {\n            \"x\": \"x of 1\"\n          }\n        },\n        {\n          \"match_phrase\": {\n            \"y\": \"y of 2\"\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\nAs mentioned, compound queries are recursively defined so we can compose combinations. For example, to match documents where (```x = x of 1``` AND ```y = y of 1```) OR (```x = x of 2``` AND ```y = y of 2```)\n\n```\nGET tglanzma-small-1/_search\n{\n  \"min_score\": 0.6,\n  \"query\": {\n    \"bool\": {\n      \"should\": [\n        {\n          \"bool\": {\n            \"must\": [\n              {\n                \"match_phrase\": {\n                  \"x\": \"x of 1\"\n                }\n              },\n              {\n                \"match_phrase\": {\n                  \"y\": \"y of 1\"\n                }\n              }\n            ]\n          }\n        },\n        {\n          \"bool\": {\n            \"must\": [\n              {\n                \"match_phrase\": {\n                  \"x\": \"x of 2\"\n                }\n              },\n              {\n                \"match_phrase\": {\n                  \"y\": \"y of 2\"\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  }\n}\n```\n","html":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n  \u003chead\u003e\n    \u003cmeta charset=\"utf-8\"\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1\"\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cnav class=\"toc\"\u003e\n      \u003col class=\"toc-level toc-level-1\"\u003e\n        \u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#what-is-elasticsearch\"\u003eWhat is Elasticsearch\u003c/a\u003e\u003c/li\u003e\n        \u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#documents--indices\"\u003eDocuments \u0026#x26; Indices\u003c/a\u003e\u003c/li\u003e\n        \u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#search--aggregations\"\u003eSearch \u0026#x26; Aggregations\u003c/a\u003e\u003c/li\u003e\n      \u003c/ol\u003e\n    \u003c/nav\u003e\n    \u003cp\u003eConcepts and examples to get reminded of once in a whilei\u003c/p\u003e\n    \u003ch2 id=\"what-is-elasticsearch\"\u003eWhat is Elasticsearch\u003c/h2\u003e\n    \u003cp\u003e\u003cem\u003eElasticsearch\u003c/em\u003e is a distributed search and analytics engine, providing a \u003cem\u003enear real-time\u003c/em\u003e search for a large array of data types, structured or un-structured.\u003c/p\u003e\n    \u003cp\u003eSome of the usecases\u003c/p\u003e\n    \u003cul\u003e\n      \u003cli\u003eBackend for search boxes\u003c/li\u003e\n      \u003cli\u003eMetrics and Log analysis\u003c/li\u003e\n    \u003c/ul\u003e\n    \u003cp\u003eElasticsearch uses \u003cem\u003eApache Lucene\u003c/em\u003e under the hood as it's underlying search engine.\u003c/p\u003e\n    \u003ch2 id=\"documents--indices\"\u003eDocuments \u0026#x26; Indices\u003c/h2\u003e\n    \u003cp\u003eTechnically, and I quote - \"Elasticsearch is a distributed documented store\". It serializes any kind of structure into JSON documents. In an Elasticsearch cluster, the documents are distributed accross multiple nodes and are accessible from any (really?) of the nodes.\u003c/p\u003e\n    \u003cp\u003e\u003cstrong\u003eTODO\u003c/strong\u003e Are the documents distributed accross all nodes, or a part of the cluster? It actually seems unreasonable to me that it is a full replication.\u003c/p\u003e\n    \u003cp\u003eElasticsearch maintains an \u003cem\u003eInverted Index\u003c/em\u003e to provide fast search capabilities on all of a document's fields (They say that a document is fully searchable within 1 sec). Practically, the index is the data structure the collects multiple documents and provides fast access to them according to search criteria.\u003c/p\u003e\n    \u003cp\u003eWe can think of the model as such\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-properties\"\u003e\u003cspan class=\"hljs-attr\"\u003eField\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003eString\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003eAny\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003eDocument\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003efields\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003eField[]\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003eIndex\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003edocuments\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003eDocument[]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eBy default, Elasticsearch index all fields in all documents, and it has different mehcanisms to index different data types.\u003c/p\u003e\n    \u003ch2 id=\"search--aggregations\"\u003eSearch \u0026#x26; Aggregations\u003c/h2\u003e\n    \u003cp\u003eElasticsearch provides a REST API that supports\u003c/p\u003e\n    \u003cul\u003e\n      \u003cli\u003eStructured queries - Queries that are structurely similiar to SQL queries\u003c/li\u003e\n      \u003cli\u003eFull text queries - Queries that return all documents that match the query, sorted by relevance\u003c/li\u003e\n      \u003cli\u003eComplex queries - A combination of the above\u003c/li\u003e\n    \u003c/ul\u003e\n    \u003cp\u003eElasticsearch can maintain aggregations of the data enabling us to analyze summaries providing insights regarding metrics, patterns and trends. For example, we can query for\u003c/p\u003e\n    \u003cul\u003e\n      \u003cli\u003eTotal numbers that match X\u003c/li\u003e\n      \u003cli\u003eThe average that match Y\u003c/li\u003e\n    \u003c/ul\u003e\n    \u003cp\u003eFurthermore, aggregations can operate alongside the search requests, meaning that we can gain aggregative information for all search results.\u003c/p\u003e\n    \u003ch3 id=\"cat-api\"\u003ecat API\u003c/h3\u003e\n    \u003cp\u003eThe \u003ccode\u003e_cat\u003c/code\u003e endpoint provides \"Compact and Aligned Text\" meaning, a general, \u003cstrong\u003econsumed by humans\u003c/strong\u003e information.\u003c/p\u003e\n    \u003cp\u003eGet the list of cat APIs\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e/_cat\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eGet information about indices using \u003ca href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-indices.html\"\u003ecat indices API\u003c/a\u003e\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-awk\"\u003e\u003cspan class=\"hljs-regexp\"\u003e/_cat/i\u003c/span\u003endices\n\u003cspan class=\"hljs-regexp\"\u003e/_cat/i\u003c/span\u003endices/_all\n\u003cspan class=\"hljs-regexp\"\u003e/_cat/i\u003c/span\u003endices?format=json\n\u003cspan class=\"hljs-regexp\"\u003e/_cat/i\u003c/span\u003endices/my-index\n\u003cspan class=\"hljs-regexp\"\u003e/_cat/i\u003c/span\u003endices/my-index?format=json\n\u003c/code\u003e\u003c/pre\u003e\n    \u003ch3 id=\"search-api\"\u003esearch API\u003c/h3\u003e\n    \u003cp\u003eThe \u003ccode\u003e\u0026#x3C;target\u003e/_search\u003c/code\u003e endpoint provides searching functionality.\u003c/p\u003e\n    \u003cp\u003eThe \u003ccode\u003e\u0026#x3C;target\u003e\u003c/code\u003e parameter is optional and is a comma seperated list indicating data streams, indices and aliases to search. It supports wildcards (*).\u003c/p\u003e\n    \u003cp\u003eThere are many query parameters that affects how the search is being performed and how the results are being returned. We won't list them all here but here is a small list that give a vibe on the kind of possible parameters\u003c/p\u003e\n    \u003cul\u003e\n      \u003cli\u003eq(string) - The query. Note that it can alternetively be provided through the body\u003c/li\u003e\n      \u003cli\u003eexplain(boolean) - If true, returns a defailed information about the score computation\u003c/li\u003e\n      \u003cli\u003etimeout(time units) - Sets the timeout for the request\u003c/li\u003e\n      \u003cli\u003efrom(integer) - Starting document offset\u003c/li\u003e\n      \u003cli\u003esize(integer) - Number of hits to return\u003c/li\u003e\n    \u003c/ul\u003e\n    \u003cp\u003eThe body also contains important information the important one is the \"query\" field.\u003c/p\u003e\n    \u003ch3 id=\"shards\"\u003eshards\u003c/h3\u003e\n    \u003cp\u003eShow shards\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-awk\"\u003e\u003cspan class=\"hljs-regexp\"\u003e/_cat/\u003c/span\u003eshards\n\u003cspan class=\"hljs-regexp\"\u003e/_cat/\u003c/span\u003eshards?h=index,shard\n\u003c/code\u003e\u003c/pre\u003e\n    \u003ch3 id=\"usage\"\u003eUsage\u003c/h3\u003e\n    \u003ch4 id=\"basics-insert-and-retrieve-documents\"\u003eBasics, insert and retrieve documents\u003c/h4\u003e\n    \u003cp\u003eAssume the scenario with indices \u003ccode\u003etglanzma-small-1,2,3\u003c/code\u003e and a document model\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-properties\"\u003e\u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003estring\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ex\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003estring\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ey\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003estring\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ez\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003enumber\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003etags\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003estring[]\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eTo add documents to and index we use the \u003ca href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html\"\u003eIndex API\u003c/a\u003e. For example\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-properties\"\u003e\u003cspan class=\"hljs-attr\"\u003ePUT\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etglanzma-small-1/_doc/1\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"x\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"x of 1\",\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"y\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"y of 1\",\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"z\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e1,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"tags\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"first\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etag of 1\",\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"second\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etag of 1\"\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e]\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eTo get a specific document by it's id we use the \u003ca href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-get.html\"\u003eDocument's Get API\u003c/a\u003e. For example\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-apache\"\u003e\u003cspan class=\"hljs-attribute\"\u003eGET\u003c/span\u003e tglanzma-small-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e/_doc/\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eTo get multiple documents by their ids, use the \u003ca href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-multi-get.html\"\u003eMulti get API\u003c/a\u003e. For example\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-properties\"\u003e\u003cspan class=\"hljs-attr\"\u003eGET\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e_mget\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"docs\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e[{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"_index\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"tglanzma-small-1\",\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"_id\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e1\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e},\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"_index\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"tglanzma-small-1\",\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"_id\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e2\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e}]\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003ch3 id=\"searching-an-index\"\u003eSearching an index\u003c/h3\u003e\n    \u003cp\u003eTo search for documents we use the \u003ca href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-search.html\"\u003eSearch API\u003c/a\u003e.\u003c/p\u003e\n    \u003cp\u003eTo search for all documents within a specific index\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-excel\"\u003eGET tglanzma-\u003cspan class=\"hljs-built_in\"\u003esmall\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e/_\u003cspan class=\"hljs-built_in\"\u003esearch\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eTo specify exactly what fields we want returned from each document we will use the \u003ccode\u003e_source\u003c/code\u003e parameter, as so\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-properties\"\u003e\u003cspan class=\"hljs-attr\"\u003eGET\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etglanzma-small-1/_search\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"_source\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"x\",\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"y\"\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e]\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eTo specify the search query we use the \u003ccode\u003equery\u003c/code\u003e parameter. This is a query object and we specify it using the \u003ca href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html\"\u003eQuery DSL\u003c/a\u003e.\u003c/p\u003e\n    \u003cp\u003eThe Query DSL is an AST defined as\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-properties\"\u003e\u003cspan class=\"hljs-attr\"\u003eQuery\u003c/span\u003e :\u003cspan class=\"hljs-string\"\u003e= Leaf | Compound\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eCompound\u003c/span\u003e :\u003cspan class=\"hljs-string\"\u003e= [Compound | Leaf]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eSearch documents where \u003ccode\u003ex === x of 1\u003c/code\u003e we use the \u003ca href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html\"\u003eMatch phrase query\u003c/a\u003e\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-properties\"\u003e\u003cspan class=\"hljs-attr\"\u003eGET\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etglanzma-small-1/_search\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"query\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"bool\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e\"must\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e\"match_phrase\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"hljs-attr\"\u003e\"x\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"x of 1\"\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eFor a fuzzy search, we use the \u003ca href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html\"\u003eMatch query\u003c/a\u003e.\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-properties\"\u003e\u003cspan class=\"hljs-attr\"\u003eGET\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etglanzma-small-1/_search\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"query\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"bool\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e\"must\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e\"match\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"hljs-attr\"\u003e\"x\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"x of 1\"\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eThe returned documents might not have an exact match because we fuzzy searched. Each document is assigned with a score determining how close it is to a full match. We can control the minimum we want using the \u003ccode\u003emin_score\u003c/code\u003e parameter\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-properties\"\u003e\u003cspan class=\"hljs-attr\"\u003eGET\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etglanzma-small-1/_search\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"min_score\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e0.6,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"query\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"bool\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e\"must\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e\"match\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"hljs-attr\"\u003e\"x\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"x of 1\"\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eThe \u003ca href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html\"\u003eBoolean query\u003c/a\u003e matches boolean combinations over documents.\u003c/p\u003e\n    \u003cp\u003eThe \u003ccode\u003emust\u003c/code\u003e acts as an AND operator and the \u003ccode\u003eshould\u003c/code\u003e acts as an OR operator. Intuitively, the \u003ccode\u003emust_not\u003c/code\u003e acts as negation.\u003c/p\u003e\n    \u003cp\u003eTo search for query that have either \u003ccode\u003ex = x of 1\u003c/code\u003e and \u003ccode\u003ey = y of 1\u003c/code\u003e we use the \u003ccode\u003emust\u003c/code\u003e query\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-properties\"\u003e\u003cspan class=\"hljs-attr\"\u003eGET\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etglanzma-small-1/_search\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"min_score\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e0.6,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"query\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"bool\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e\"must\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e\"match_phrase\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"hljs-attr\"\u003e\"x\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"x of 1\"\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e\"match_phrase\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"hljs-attr\"\u003e\"y\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"y of 1\"\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eTo search for query that have either \u003ccode\u003ex = x of 1\u003c/code\u003e or \u003ccode\u003ey = y of 2\u003c/code\u003e we use the \u003ccode\u003eshould\u003c/code\u003e query\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-properties\"\u003e\u003cspan class=\"hljs-attr\"\u003eGET\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etglanzma-small-1/_search\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"min_score\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e0.6,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"query\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"bool\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e\"should\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e\"match_phrase\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"hljs-attr\"\u003e\"x\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"x of 1\"\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e\"match_phrase\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"hljs-attr\"\u003e\"y\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"y of 2\"\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eAs mentioned, compound queries are recursively defined so we can compose combinations. For example, to match documents where (\u003ccode\u003ex = x of 1\u003c/code\u003e AND \u003ccode\u003ey = y of 1\u003c/code\u003e) OR (\u003ccode\u003ex = x of 2\u003c/code\u003e AND \u003ccode\u003ey = y of 2\u003c/code\u003e)\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-properties\"\u003e\u003cspan class=\"hljs-attr\"\u003eGET\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etglanzma-small-1/_search\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"min_score\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e0.6,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"query\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"bool\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e\"should\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e\"bool\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"hljs-attr\"\u003e\"must\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e[\u003c/span\u003e\n              \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"hljs-attr\"\u003e\"match_phrase\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n                  \u003cspan class=\"hljs-attr\"\u003e\"x\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"x of 1\"\u003c/span\u003e\n                \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n              \u003cspan class=\"hljs-attr\"\u003e},\u003c/span\u003e\n              \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"hljs-attr\"\u003e\"match_phrase\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n                  \u003cspan class=\"hljs-attr\"\u003e\"y\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"y of 1\"\u003c/span\u003e\n                \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n              \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"hljs-attr\"\u003e]\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e\"bool\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"hljs-attr\"\u003e\"must\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e[\u003c/span\u003e\n              \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"hljs-attr\"\u003e\"match_phrase\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n                  \u003cspan class=\"hljs-attr\"\u003e\"x\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"x of 2\"\u003c/span\u003e\n                \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n              \u003cspan class=\"hljs-attr\"\u003e},\u003c/span\u003e\n              \u003cspan class=\"hljs-attr\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"hljs-attr\"\u003e\"match_phrase\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n                  \u003cspan class=\"hljs-attr\"\u003e\"y\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"y of 2\"\u003c/span\u003e\n                \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n              \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"hljs-attr\"\u003e]\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n"}}},"__N_SSG":true},"page":"/_articles/[...articleId]","query":{"articleId":["elastic","overview"]},"buildId":"2MCVNdTWbOVg7ou666Ke5","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>