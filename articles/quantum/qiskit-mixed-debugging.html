<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/66d0883758355d1f.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/1cb3813e458884a4.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-91d24a11915ed1c5.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-672a444f700a8e5a.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-7e5eafffd19dca44.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-d355f2bc91b5bf25.js" async="" crossorigin=""></script><script src="/_next/static/chunks/326-dcee1ff54fa4f70c.js" async=""></script><script src="/_next/static/chunks/app/layout-679af891320360de.js" async=""></script><script src="/_next/static/chunks/d3ac728e-1e5d8b71e3d43fec.js" async=""></script><script src="/_next/static/chunks/app/articles/%5B...slug%5D/page-44f6caefb92fad34.js" async=""></script><title>Article</title><meta name="description" content="Personal site"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="256x256"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="__className_d65c78 Layout_body__oXsmr"><header class="Layout_header__XC_Gv"><div class="NavBar_container__pKdC7"><a class="link" href="/">Home</a><a class="link" href="/academic">Academic Work</a><a class="link" href="/categories">Categories</a><a class="link" href="/articles">All</a><a class="link" href="/articles/about">About</a></div></header><main class="Layout_main__luTTh"><div class="article-page_container__5yaZl"><h1>Qiskit mixed debugging</h1><div class="Taxonomy_container__C2Vdb"><div class="Taxonomy_values__yvK16"><a href="/tags/Quantum_Computing"><div class="Chip_container__q1AW2">Quantum Computing</div></a><a href="/tags/Qiskit"><div class="Chip_container__q1AW2">Qiskit</div></a></div></div><div class="ArticleContent_md__SxPPI"><!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <nav class="toc">
      <ol class="toc-level toc-level-1">
        <li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#debugging">Debugging</a></li>
      </ol>
    </nav>
    <p><a href="https://github.com/Qiskit/qiskit">Qiskit</a> is an open-source SDK for working with quantum computers at the level of extended quantum circuits, operators, and primitives. Qiskit's API is provided as a python library but it has many components that are implemented natively in <a href="https://github.com/rust-lang/rust">Rust</a> to optimize CPU workloads.</p>
    <p>As developers, we would like to debug the code starting from the API level and sometimes all the way through the native libraries. Although desirable, debugging managed and native environments together can be somewhat tricky.</p>
    <p>Here we will do just that, using <a href="https://code.visualstudio.com/">vscode</a>. It is assumed that you have Qiskit locally and know how to run it locally. We will need the following vscode extensions:</p>
    <ul>
      <li><a href="https://marketplace.visualstudio.com/items?itemName=ms-python.debugpy">Python Debugger</a> to debug the python code</li>
      <li><a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">CodeLLDB</a> to debug the native code</li>
    </ul>
    <p>As a simple use case, let's create a small python example that invokes a native function. Create a file at `</p>
    <p>Vscode launch configurations are found in <code>.vscode/launch.json</code> under the <code>configurations</code> field in <code>examples/python/debug.py</code> with the contents:</p>
    <pre><code class="hljs language-python"><span class="hljs-keyword">from</span> qiskit._accelerate.circuit <span class="hljs-keyword">import</span> CircuitData

circuit_data = CircuitData()
circuit_data.clear()
</code></pre>
    <p>Notice how <code>CircuitData</code> is being imported from the <code>_accelerate</code> native module. The <code>clear</code> method is defined in <code>crates/accelerate/circuit/src/circuit_data.rs</code> file and it's signature is:</p>
    <pre><code class="hljs language-rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">clear</span>(&#x26;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>)
</code></pre>
    <p>Let's add two breakpoints, one at the start of the python file and the other at the first body line of the native clear method.</p>
    <h2 id="debugging">Debugging</h2>
    <p>To configure launch options in vscode we need to edit the file <code>.vscode/launch.json</code>. Specifically, we will edit the configuration attribute. A launch file with no configurations should look similar to this:</p>
    <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
    <p>Now we need to configure the debugger configuration. In reality, we need to active debuggers - Python debugger and a native debugger.</p>
    <p><strong>Python script debug</strong></p>
    <p>First, lets define a python debugger and make sure we can debug the python file we have created. In the configuration attribute, add a new object as follows:</p>
    <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Debug python file"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"debugpy"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"request"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"launch"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"program"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${workspaceFolder}/examples/python/debug.py"</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
    <p>We should now have a "Debug python file" launch option under the "Run and Debug" tab. Make sure that when you click on the play button the breakpoint we have defined in <code>debug.py</code> is catched.</p>
    <p><strong>Native debug</strong></p>
    <p>To debug the native code we need to understand this - To use the native code, (the executable) python dynamically links against the shared object. The shared object output is a <code>.so</code> file produced by building the Rust code. If you havn't done so, build it now, in debug mode:</p>
    <pre><code>RUST_DEBUG=1 python setup.py build_rust --inplace
</code></pre>
    <p>In my enviornment, the output is at <code>qiskit/_accelerate.cpython-312-darwin.so</code>. In your environment it is probably located in the same place with another/same name.</p>
    <p>To debug the native code, we actually need to debug (the executable) python ifself because it is the process who runs the native code. To do so, add the following configuration to the <code>launch.json</code> file:</p>
    <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"LLDB Attach"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lldb"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"request"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"attach"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"program"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${workspaceFolder}/qiskit/_accelerate.cpython-312-darwin.so"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"pid"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${command:pickProcess}"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"stopOnEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
    <blockquote>
      <p>Remember to change the .so file path as needed!</p>
    </blockquote>
    <p>There should now be another launch option called "LLDB Attach". When paused on the python script, python is running. When launching the new launch option, it will open an input box to insert the pid of the executable. In the text box, enter "python" to filter the relevant processes and select the relevant process (usually it will be the top filtered process since it ran the latest).</p>
    <p>Now our native debugger is attached to python and we are ready to debug the native code. If you set a breakpoint in the native code at the <code>clear</code> method as described earlier, you can resume debugging and it should land in the native code!</p>
  </body>
</html>
</div></div></main><footer><div class="Footer_container__Z8cUU"><a href="https://il.linkedin.com/in/tal-glanzman"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a href="https://github.com/tglanz"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></div></footer><script src="/_next/static/chunks/webpack-91d24a11915ed1c5.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/a34f9d1faa5f3315-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/66d0883758355d1f.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:HL[\"/_next/static/css/1cb3813e458884a4.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[3728,[],\"\"]\n7:I[9928,[],\"\"]\n8:I[5420,[\"326\",\"static/chunks/326-dcee1ff54fa4f70c.js\",\"185\",\"static/chunks/app/layout-679af891320360de.js\"],\"\"]\n9:I[6954,[],\"\"]\na:I[7264,[],\"\"]\nd:I[8326,[\"954\",\"static/chunks/d3ac728e-1e5d8b71e3d43fec.js\",\"326\",\"static/chunks/326-dcee1ff54fa4f70c.js\",\"496\",\"static/chunks/app/articles/%5B...slug%5D/page-44f6caefb92fad34.js\"],\"\"]\ne:T518,"])</script><script>self.__next_f.push([1,"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/66d0883758355d1f.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"unFc_cxHuLzltpPwdriAt\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/articles/quantum/qiskit-mixed-debugging\",\"initialTree\":[\"\",{\"children\":[\"articles\",{\"children\":[[\"slug\",\"quantum/qiskit-mixed-debugging\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"quantum\\\",\\\"qiskit-mixed-debugging\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L6\"],\"globalErrorComponent\":\"$7\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_d65c78 Layout_body__oXsmr\",\"children\":[[\"$\",\"header\",null,{\"className\":\"Layout_header__XC_Gv\",\"children\":[\"$\",\"$L8\",null,{}]}],[\"$\",\"main\",null,{\"className\":\"Layout_main__luTTh\",\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"initialChildNode\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"articles\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"initialChildNode\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"articles\",\"children\",[\"slug\",\"quantum/qiskit-mixed-debugging\",\"c\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"initialChildNode\":[\"$Lb\",\"$Lc\",null],\"childPropSegment\":\"__PAGE__?{\\\"slug\\\":[\\\"quantum\\\",\\\"qiskit-mixed-debugging\\\"]}\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/1cb3813e458884a4.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],\"childPropSegment\":[\"slug\",\"quantum/qiskit-mixed-debugging\",\"c\"],\"styles\":null}],\"childPropSegment\":\"articles\",\"styles\":null}]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"Footer_container__Z8cUU\",\"children\":[[\"$\",\"$Ld\",null,{\"href\":\"https://il.linkedin.com/in/tal-glanzman\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 448 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":25,\"width\":25,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],[\"$\",\"$Ld\",null,{\"href\":\"https://github.com/tglanz\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 496 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$e\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":25,\"width\":25,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]]}]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Article\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Personal site\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"256x256\"}],[\"$\",\"meta\",\"5\",{\"name\":\"next-size-adjust\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"f:I[6222,[\"954\",\"static/chunks/d3ac728e-1e5d8b71e3d43fec.js\",\"326\",\"static/chunks/326-dcee1ff54fa4f70c.js\",\"496\",\"static/chunks/app/articles/%5B...slug%5D/page-44f6caefb92fad34.js\"],\"ArticleContent\"]\n10:T10e0,"])</script><script>self.__next_f.push([1,"\n[Qiskit](https://github.com/Qiskit/qiskit) is an open-source SDK for working with quantum computers at the level of extended quantum circuits, operators, and primitives. Qiskit's API is provided as a python library but it has many components that are implemented natively in [Rust](https://github.com/rust-lang/rust) to optimize CPU workloads.\n\nAs developers, we would like to debug the code starting from the API level and sometimes all the way through the native libraries. Although desirable, debugging managed and native environments together can be somewhat tricky.\n\nHere we will do just that, using [vscode](https://code.visualstudio.com/). It is assumed that you have Qiskit locally and know how to run it locally. We will need the following vscode extensions:\n- [Python Debugger](https://marketplace.visualstudio.com/items?itemName=ms-python.debugpy) to debug the python code\n- [CodeLLDB](https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb) to debug the native code\n\nAs a simple use case, let's create a small python example that invokes a native function. Create a file at `\n\nVscode launch configurations are found in `.vscode/launch.json` under the `configurations` field in `examples/python/debug.py` with the contents:\n```python\nfrom qiskit._accelerate.circuit import CircuitData\n\ncircuit_data = CircuitData()\ncircuit_data.clear()\n```\n\nNotice how `CircuitData` is being imported from the `_accelerate` native module. The `clear` method is defined in `crates/accelerate/circuit/src/circuit_data.rs` file and it's signature is:\n```rust\npub fn clear(\u0026mut self)\n```\n\nLet's add two breakpoints, one at the start of the python file and the other at the first body line of the native clear method.\n\n## Debugging\n\nTo configure launch options in vscode we need to edit the file `.vscode/launch.json`. Specifically, we will edit the configuration attribute. A launch file with no configurations should look similar to this:\n\n```json\n{\n    \"version\": \"0.2.0\",\n    \"configurations\": [],\n}\n```\n\nNow we need to configure the debugger configuration. In reality, we need to active debuggers - Python debugger and a native debugger.\n\n**Python script debug**\n\nFirst, lets define a python debugger and make sure we can debug the python file we have created. In the configuration attribute, add a new object as follows:\n\n```json\n{\n    \"name\": \"Debug python file\",\n    \"type\": \"debugpy\",\n    \"request\": \"launch\",\n    \"program\": \"${workspaceFolder}/examples/python/debug.py\",\n}\n```\n\nWe should now have a \"Debug python file\" launch option under the \"Run and Debug\" tab. Make sure that when you click on the play button the breakpoint we have defined in `debug.py` is catched.\n\n**Native debug**\n\nTo debug the native code we need to understand this - To use the native code, (the executable) python dynamically links against the shared object. The shared object output is a `.so` file produced by building the Rust code. If you havn't done so, build it now, in debug mode:\n\n```\nRUST_DEBUG=1 python setup.py build_rust --inplace\n```\n\nIn my enviornment, the output is at `qiskit/_accelerate.cpython-312-darwin.so`. In your environment it is probably located in the same place with another/same name.\n\nTo debug the native code, we actually need to debug (the executable) python ifself because it is the process who runs the native code. To do so, add the following configuration to the `launch.json` file:\n\n```json\n{\n    \"name\": \"LLDB Attach\",\n    \"type\": \"lldb\",\n    \"request\": \"attach\",\n    \"program\": \"${workspaceFolder}/qiskit/_accelerate.cpython-312-darwin.so\",\n    \"pid\": \"${command:pickProcess}\",\n    \"stopOnEntry\": false,\n}\n```\n\n\u003e Remember to change the .so file path as needed!\n\nThere should now be another launch option called \"LLDB Attach\". When paused on the python script, python is running. When launching the new launch option, it will open an input box to insert the pid of the executable. In the text box, enter \"python\" to filter the relevant processes and select the relevant process (usually it will be the top filtered process since it ran the latest).\n\nNow our native debugger is attached to python and we are ready to debug the native code. If you set a breakpoint in the native code at the `clear` method as described earlier, you can resume debugging and it should land in the native code!"])</script><script>self.__next_f.push([1,"11:T1e08,"])</script><script>self.__next_f.push([1,"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n  \u003chead\u003e\n    \u003cmeta charset=\"utf-8\"\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1\"\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cnav class=\"toc\"\u003e\n      \u003col class=\"toc-level toc-level-1\"\u003e\n        \u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#debugging\"\u003eDebugging\u003c/a\u003e\u003c/li\u003e\n      \u003c/ol\u003e\n    \u003c/nav\u003e\n    \u003cp\u003e\u003ca href=\"https://github.com/Qiskit/qiskit\"\u003eQiskit\u003c/a\u003e is an open-source SDK for working with quantum computers at the level of extended quantum circuits, operators, and primitives. Qiskit's API is provided as a python library but it has many components that are implemented natively in \u003ca href=\"https://github.com/rust-lang/rust\"\u003eRust\u003c/a\u003e to optimize CPU workloads.\u003c/p\u003e\n    \u003cp\u003eAs developers, we would like to debug the code starting from the API level and sometimes all the way through the native libraries. Although desirable, debugging managed and native environments together can be somewhat tricky.\u003c/p\u003e\n    \u003cp\u003eHere we will do just that, using \u003ca href=\"https://code.visualstudio.com/\"\u003evscode\u003c/a\u003e. It is assumed that you have Qiskit locally and know how to run it locally. We will need the following vscode extensions:\u003c/p\u003e\n    \u003cul\u003e\n      \u003cli\u003e\u003ca href=\"https://marketplace.visualstudio.com/items?itemName=ms-python.debugpy\"\u003ePython Debugger\u003c/a\u003e to debug the python code\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb\"\u003eCodeLLDB\u003c/a\u003e to debug the native code\u003c/li\u003e\n    \u003c/ul\u003e\n    \u003cp\u003eAs a simple use case, let's create a small python example that invokes a native function. Create a file at `\u003c/p\u003e\n    \u003cp\u003eVscode launch configurations are found in \u003ccode\u003e.vscode/launch.json\u003c/code\u003e under the \u003ccode\u003econfigurations\u003c/code\u003e field in \u003ccode\u003eexamples/python/debug.py\u003c/code\u003e with the contents:\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e qiskit._accelerate.circuit \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e CircuitData\n\ncircuit_data = CircuitData()\ncircuit_data.clear()\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eNotice how \u003ccode\u003eCircuitData\u003c/code\u003e is being imported from the \u003ccode\u003e_accelerate\u003c/code\u003e native module. The \u003ccode\u003eclear\u003c/code\u003e method is defined in \u003ccode\u003ecrates/accelerate/circuit/src/circuit_data.rs\u003c/code\u003e file and it's signature is:\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-rust\"\u003e\u003cspan class=\"hljs-keyword\"\u003epub\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eclear\u003c/span\u003e(\u0026#x26;\u003cspan class=\"hljs-keyword\"\u003emut\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eself\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eLet's add two breakpoints, one at the start of the python file and the other at the first body line of the native clear method.\u003c/p\u003e\n    \u003ch2 id=\"debugging\"\u003eDebugging\u003c/h2\u003e\n    \u003cp\u003eTo configure launch options in vscode we need to edit the file \u003ccode\u003e.vscode/launch.json\u003c/code\u003e. Specifically, we will edit the configuration attribute. A launch file with no configurations should look similar to this:\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"0.2.0\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"configurations\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eNow we need to configure the debugger configuration. In reality, we need to active debuggers - Python debugger and a native debugger.\u003c/p\u003e\n    \u003cp\u003e\u003cstrong\u003ePython script debug\u003c/strong\u003e\u003c/p\u003e\n    \u003cp\u003eFirst, lets define a python debugger and make sure we can debug the python file we have created. In the configuration attribute, add a new object as follows:\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Debug python file\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"type\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"debugpy\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"request\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"launch\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"program\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"${workspaceFolder}/examples/python/debug.py\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eWe should now have a \"Debug python file\" launch option under the \"Run and Debug\" tab. Make sure that when you click on the play button the breakpoint we have defined in \u003ccode\u003edebug.py\u003c/code\u003e is catched.\u003c/p\u003e\n    \u003cp\u003e\u003cstrong\u003eNative debug\u003c/strong\u003e\u003c/p\u003e\n    \u003cp\u003eTo debug the native code we need to understand this - To use the native code, (the executable) python dynamically links against the shared object. The shared object output is a \u003ccode\u003e.so\u003c/code\u003e file produced by building the Rust code. If you havn't done so, build it now, in debug mode:\u003c/p\u003e\n    \u003cpre\u003e\u003ccode\u003eRUST_DEBUG=1 python setup.py build_rust --inplace\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cp\u003eIn my enviornment, the output is at \u003ccode\u003eqiskit/_accelerate.cpython-312-darwin.so\u003c/code\u003e. In your environment it is probably located in the same place with another/same name.\u003c/p\u003e\n    \u003cp\u003eTo debug the native code, we actually need to debug (the executable) python ifself because it is the process who runs the native code. To do so, add the following configuration to the \u003ccode\u003elaunch.json\u003c/code\u003e file:\u003c/p\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"LLDB Attach\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"type\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"lldb\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"request\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"attach\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"program\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"${workspaceFolder}/qiskit/_accelerate.cpython-312-darwin.so\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"pid\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"${command:pickProcess}\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"stopOnEntry\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003e\u003cspan class=\"hljs-keyword\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n    \u003cblockquote\u003e\n      \u003cp\u003eRemember to change the .so file path as needed!\u003c/p\u003e\n    \u003c/blockquote\u003e\n    \u003cp\u003eThere should now be another launch option called \"LLDB Attach\". When paused on the python script, python is running. When launching the new launch option, it will open an input box to insert the pid of the executable. In the text box, enter \"python\" to filter the relevant processes and select the relevant process (usually it will be the top filtered process since it ran the latest).\u003c/p\u003e\n    \u003cp\u003eNow our native debugger is attached to python and we are ready to debug the native code. If you set a breakpoint in the native code at the \u003ccode\u003eclear\u003c/code\u003e method as described earlier, you can resume debugging and it should land in the native code!\u003c/p\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n"])</script><script>self.__next_f.push([1,"c:[\"$\",\"div\",null,{\"className\":\"article-page_container__5yaZl\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"Qiskit mixed debugging\"}],[\"$\",\"div\",null,{\"className\":\"Taxonomy_container__C2Vdb\",\"children\":[\"$\",\"div\",null,{\"className\":\"Taxonomy_values__yvK16\",\"children\":[[\"$\",\"$Ld\",\"0\",{\"href\":\"/tags/Quantum_Computing\",\"children\":[\"$\",\"div\",null,{\"className\":\"Chip_container__q1AW2\",\"children\":\"Quantum Computing\"}]}],[\"$\",\"$Ld\",\"1\",{\"href\":\"/tags/Qiskit\",\"children\":[\"$\",\"div\",null,{\"className\":\"Chip_container__q1AW2\",\"children\":\"Qiskit\"}]}]]}]}],[\"$\",\"$Lf\",null,{\"content\":{\"raw\":\"$10\",\"html\":\"$11\"}}]]}]\n"])</script><script>self.__next_f.push([1,""])</script></body></html>